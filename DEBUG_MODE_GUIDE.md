# üîç –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏

## –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ (FLASH vs PRO) –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —á–µ–∫–∞. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è:

- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ LBP-–∞–Ω–∞–ª–∏–∑–∞
- –û—Ç–ª–∞–¥–∫–∏ –ª–æ–≥–∏–∫–∏ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
- –ë—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –±–µ–∑ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ AI-–∑–∞–ø—Ä–æ—Å—ã

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ `.env` —Ñ–∞–π–ª:

```bash
# –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
GEMINI_ANALYSIS_MODE=debug

# –ò–ª–∏ –¥–ª—è production —Ä–µ–∂–∏–º–∞
GEMINI_ANALYSIS_MODE=production
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:

```bash
python run_local.py
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (`debug`)

1. **–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∏ –ø–æ–∏—Å–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤
2. **LBP-–∞–Ω–∞–ª–∏–∑**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è LBP-–¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä –∏ —ç–Ω—Ç—Ä–æ–ø–∏—è
3. **–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è, –ø–µ—á–∞—Ç–Ω—ã–π —ç—Ç–æ —Ç–µ–∫—Å—Ç –∏–ª–∏ —Ä—É–∫–æ–ø–∏—Å–Ω—ã–π
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
5. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞**: –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

**–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏:**
```
üîç –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏: –¥–ª—è —ç—Ç–æ–≥–æ —á–µ–∫–∞ –≤—ã–±—Ä–∞–Ω–∞ –º–æ–¥–µ–ª—å FLASH
```

### –†–µ–∂–∏–º production (`production`)

1. **–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∏ –ø–æ–∏—Å–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤
2. **LBP-–∞–Ω–∞–ª–∏–∑**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è LBP-–¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä –∏ —ç–Ω—Ç—Ä–æ–ø–∏—è
3. **–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è, –ø–µ—á–∞—Ç–Ω—ã–π —ç—Ç–æ —Ç–µ–∫—Å—Ç –∏–ª–∏ —Ä—É–∫–æ–ø–∏—Å–Ω—ã–π
4. **AI-–∞–Ω–∞–ª–∏–∑**: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é Gemini
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —á–µ–∫–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
python test_debug_mode.py
```

### 2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –≤ –±–æ—Ç–∞:

- –í —Ä–µ–∂–∏–º–µ `debug`: –ø–æ–ª—É—á–∏—Ç–µ —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
- –í —Ä–µ–∂–∏–º–µ `production`: –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —á–µ–∫–∞

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã LBP-–∞–Ω–∞–ª–∏–∑–∞

- **–ü–æ—Ä–æ–≥ —Ä—É–∫–æ–ø–∏—Å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞**: `HANDWRITTEN_LBP_THRESHOLD = 0.4`
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—É–∫–æ–ø–∏—Å–Ω—ã—Ö –±–ª–æ–∫–æ–≤**: `MIN_HANDWRITTEN_BLOCKS = 2`
- **LBP –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**: `radius=1, n_points=8`

## –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏

1. **–ê–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞**:
   - –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è LBP-–¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä
   - –°—Ç—Ä–æ–∏—Ç—Å—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ LBP-–∑–Ω–∞—á–µ–Ω–∏–π
   - –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è —ç–Ω—Ç—Ä–æ–ø–∏—è –∫–∞–∫ "–∏–Ω–¥–µ–∫—Å –æ–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç–∏"

2. **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –±–ª–æ–∫–∞**:
   - –ï—Å–ª–∏ —ç–Ω—Ç—Ä–æ–ø–∏—è < 0.4 ‚Üí –±–ª–æ–∫ —Ä—É–∫–æ–ø–∏—Å–Ω—ã–π
   - –ò–Ω–∞—á–µ ‚Üí –±–ª–æ–∫ –ø–µ—á–∞—Ç–Ω—ã–π

3. **–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏**:
   - –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚â•2 —Ä—É–∫–æ–ø–∏—Å–Ω—ã—Ö –±–ª–æ–∫–∞ ‚Üí –º–æ–¥–µ–ª—å PRO
   - –ò–Ω–∞—á–µ ‚Üí –º–æ–¥–µ–ª—å FLASH

## –û—Ç–ª–∞–¥–∫–∞

### –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

–í —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
üîç –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...
üîç –ò—â–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏...
üîç –ù–∞–π–¥–µ–Ω–æ 5 —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤
üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –±–ª–æ–∫ 1/5: (100, 50, 200, 30)
üîç –ë–ª–æ–∫ 1: –∏–Ω–¥–µ–∫—Å –æ–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç–∏ = 0.250
‚úçÔ∏è –ë–ª–æ–∫ 1 –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ —Ä—É–∫–æ–ø–∏—Å–Ω—ã–π!
üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –±–ª–æ–∫ 2/5: (100, 90, 200, 30)
üîç –ë–ª–æ–∫ 2: –∏–Ω–¥–µ–∫—Å –æ–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç–∏ = 0.650
üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –±–ª–æ–∫ 3/5: (100, 130, 200, 30)
üîç –ë–ª–æ–∫ 3: –∏–Ω–¥–µ–∫—Å –æ–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç–∏ = 0.180
‚úçÔ∏è –ë–ª–æ–∫ 3 –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ —Ä—É–∫–æ–ø–∏—Å–Ω—ã–π!
‚úçÔ∏è –ù–∞–π–¥–µ–Ω–æ 2 —Ä—É–∫–æ–ø–∏—Å–Ω—ã—Ö –±–ª–æ–∫–æ–≤, –≤—ã–±–∏—Ä–∞–µ–º –º–æ–¥–µ–ª—å PRO
üéØ –í—ã–±—Ä–∞–Ω–∞ –º–æ–¥–µ–ª—å: pro
üîç –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏: –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `utils/receipt_analyzer.py`:

```python
# –ü–æ—Ä–æ–≥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä—É–∫–æ–ø–∏—Å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
HANDWRITTEN_LBP_THRESHOLD = 0.4  # –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—É–∫–æ–ø–∏—Å–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞ PRO
MIN_HANDWRITTEN_BLOCKS = 2  # –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
```

## –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

### –í —Ñ–∞–π–ª–µ .env:
```bash
# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤ —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
GEMINI_ANALYSIS_MODE=debug

# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤ production —Ä–µ–∂–∏–º
GEMINI_ANALYSIS_MODE=production
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞:
```bash
python run_local.py
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ "–ú–æ–¥—É–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"
```bash
pip install -r requirements_local.txt
```

### –û—à–∏–±–∫–∞ "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
- –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –≤ –±–æ—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `last_photo.jpg`
- –ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞

### –û—à–∏–±–∫–∞ "–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `GEMINI_ANALYSIS_MODE` –∑–∞–¥–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–∞—Ö —á–µ–∫–æ–≤:

1. **–ü–µ—á–∞—Ç–Ω—ã–π —á–µ–∫** (–¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å FLASH):
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `GEMINI_ANALYSIS_MODE=debug`
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –ø–µ—á–∞—Ç–Ω–æ–≥–æ —á–µ–∫–∞
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–∞ –º–æ–¥–µ–ª—å FLASH

2. **–†—É–∫–æ–ø–∏—Å–Ω—ã–π —á–µ–∫** (–¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å PRO):
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `GEMINI_ANALYSIS_MODE=debug`
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —Ä—É–∫–æ–ø–∏—Å–Ω–æ–≥–æ —á–µ–∫–∞
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–∞ –º–æ–¥–µ–ª—å PRO

3. **–°–º–µ—à–∞–Ω–Ω—ã–π —á–µ–∫** (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä—É–∫–æ–ø–∏—Å–Ω—ã—Ö –±–ª–æ–∫–æ–≤):
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `GEMINI_ANALYSIS_MODE=debug`
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —á–µ–∫–∞
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏–∫—É –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
