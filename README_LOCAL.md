# AI Bot - Локальная разработка

Этот документ описывает, как работать с локальной версией AI Bot для разработки и тестирования.

## Структура проекта

- `main.py` - **Production версия** (FastAPI + webhook для Google Cloud Run)
- `main_local.py` - **Локальная версия** (polling для разработки)
- `run_local.py` - Скрипт для запуска локальной версии
- `requirements.txt` - Зависимости для production
- `requirements_local.txt` - Зависимости для локальной разработки

## Быстрый старт

### 1. Установка зависимостей

```bash
# Установка зависимостей для локальной разработки
pip install -r requirements_local.txt
```

### 2. Настройка переменных окружения

```bash
# Копируем пример файла конфигурации
cp env.example .env

# Редактируем .env файл и добавляем ваши токены
# BOT_TOKEN=your_telegram_bot_token
# POSTER_TOKEN=your_poster_api_token  
# PROJECT_ID=your_google_cloud_project_id
```

### 3. Запуск локальной версии

```bash
# Запуск через скрипт (рекомендуется)
python run_local.py

# Или прямой запуск
python main_local.py
```

## Работа с проектом

### Локальная разработка

1. **Редактируйте код** в любых файлах проекта
2. **Тестируйте изменения** через `python run_local.py`
3. **Локальная версия использует polling** - не требует webhook URL

### Деплой в production

1. **Коммитьте изменения** в main ветку
2. **Push в GitHub** автоматически запускает деплой в Google Cloud Run
3. **Production версия использует webhook** - работает через FastAPI

## Основные различия

| Аспект | Локальная версия | Production версия |
|--------|------------------|-------------------|
| **Запуск** | `python run_local.py` | `python main.py` |
| **Протокол** | Polling | Webhook (FastAPI) |
| **Зависимости** | `requirements_local.txt` | `requirements.txt` |
| **Переменные** | `.env` файл | Environment variables |
| **Порт** | Не нужен | 8080 (Cloud Run) |

## Полезные команды

```bash
# Установка зависимостей
pip install -r requirements_local.txt

# Запуск локальной версии
python run_local.py

# Проверка синтаксиса
python -m py_compile main_local.py

# Запуск production версии (для тестирования)
python main.py
```

## Структура файлов

```
AI Bot/
├── main.py                 # Production версия (FastAPI + webhook)
├── main_local.py          # Локальная версия (polling)
├── run_local.py           # Скрипт запуска локальной версии
├── requirements.txt       # Production зависимости
├── requirements_local.txt # Локальные зависимости
├── env.example           # Пример конфигурации
├── .env                  # Ваши токены (создать вручную)
├── config/               # Конфигурация
├── handlers/             # Обработчики сообщений
├── services/             # Сервисы
├── utils/                # Утилиты
└── README_LOCAL.md       # Этот файл
```

## Troubleshooting

### Ошибка "BOT_TOKEN не найден"
- Убедитесь, что файл `.env` существует
- Проверьте, что в `.env` указан правильный `BOT_TOKEN`

### Ошибка "Конфликт обнаружен"
- Остановите другие экземпляры бота
- Подождите несколько секунд и попробуйте снова

### Ошибка импорта модулей
- Установите зависимости: `pip install -r requirements_local.txt`
- Проверьте, что вы находитесь в правильной директории

### Бот не отвечает
- Проверьте интернет-соединение
- Убедитесь, что токен бота правильный
- Проверьте логи на наличие ошибок

## Разработка

### Добавление новых функций

1. **Редактируйте код** в соответствующих модулях
2. **Тестируйте локально** через `python run_local.py`
3. **Коммитьте изменения** в main ветку
4. **Изменения автоматически деплоятся** в Google Cloud Run

### Структура кода

- `handlers/` - Обработчики сообщений и callback'ов
- `services/` - Бизнес-логика (AI, Google Sheets, etc.)
- `utils/` - Вспомогательные функции
- `config/` - Конфигурация и настройки
- `models/` - Модели данных

## Поддержка

При возникновении проблем:

1. Проверьте логи в консоли
2. Убедитесь, что все зависимости установлены
3. Проверьте правильность токенов в `.env`
4. Обратитесь к документации Telegram Bot API
