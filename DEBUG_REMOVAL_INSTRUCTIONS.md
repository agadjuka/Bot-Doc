# Инструкции по удалению дебаг-функции Gemini

## Что было добавлено

Дебаг-функция для логирования всех запросов к Gemini API была добавлена в следующие файлы:

### 1. Новый файл: `debug_gemini_logger.py`
- **УДАЛИТЬ ПОЛНОСТЬЮ** - это временный файл

### 2. Изменения в существующих файлах:

#### `services/ai_service.py`
- Добавлен импорт дебаг-функции (строки 15-22)
- Добавлено логирование в метод `get_ai_response` (строки 81-89, 102-108, 115-122)

#### `services/document_parser_service.py`
- Добавлен импорт дебаг-функции (строки 13-20)
- Добавлено логирование в метод `parse_company_info` (строки 80-88, 99-105, 130-137, 145-152)

#### `services/template_processor_service.py`
- Добавлен импорт дебаг-функции (строки 22-29)
- Добавлено логирование в метод `_send_gemini_request` (строки 444-452, 461-467, 474-481, 489-496)

#### `main_local.py`
- Добавлена автоочистка при запуске (строки 31-36)

## Как удалить дебаг-функцию

### Шаг 1: Удалить файл дебаг-логгера
```bash
rm debug_gemini_logger.py
```

### Шаг 2: Удалить папку с логами
```bash
rm -rf debug_gemini_logs/
```

### Шаг 3: Удалить изменения из файлов

#### В `services/ai_service.py`:
- Удалить строки 15-22 (импорт дебаг-функции)
- Удалить строки 81-89 (логирование запроса)
- Удалить строки 102-108 (логирование ответа)
- Удалить строки 115-122 (логирование ошибки)

#### В `services/document_parser_service.py`:
- Удалить строки 13-20 (импорт дебаг-функции)
- Удалить строки 80-88 (логирование запроса)
- Удалить строки 99-105 (логирование ответа)
- Удалить строки 130-137 (логирование ошибки парсинга)
- Удалить строки 145-152 (логирование общей ошибки)

#### В `services/template_processor_service.py`:
- Удалить строки 22-29 (импорт дебаг-функции)
- Удалить строки 444-452 (логирование запроса)
- Удалить строки 461-467 (логирование ответа)
- Удалить строки 474-481 (логирование пустого ответа)
- Удалить строки 489-496 (логирование ошибки)

#### В `main_local.py`:
- Удалить строки 31-36 (автоочистка при запуске)

### Шаг 4: Удалить этот файл инструкций
```bash
rm DEBUG_REMOVAL_INSTRUCTIONS.md
```

## Что делает дебаг-функция

1. **Создает папку** `debug_gemini_logs/` в корне проекта
2. **Логирует каждый запрос** к Gemini в отдельный JSON файл с временной меткой
3. **Логирует каждый ответ** от Gemini в связанный файл
4. **Автоматически очищает** папку при каждом запуске бота
5. **Безопасно работает** - если файл дебаг-логгера отсутствует, код продолжает работать без ошибок

## Формат логов

### Файл запроса: `gemini_request_ServiceName_YYYYMMDD_HHMMSS_microseconds.json`
```json
{
  "timestamp": "2024-01-15T10:30:45.123456",
  "service_name": "AIService",
  "user_id": null,
  "prompt_length": 1500,
  "prompt_text": "Полный текст запроса к Gemini...",
  "additional_info": {
    "user_text": "Текст пользователя",
    "language": "ru"
  }
}
```

### Файл ответа: `gemini_request_ServiceName_YYYYMMDD_HHMMSS_microseconds_response.json`
```json
{
  "timestamp": "2024-01-15T10:30:47.654321",
  "success": true,
  "response_length": 800,
  "response_text": "Ответ от Gemini...",
  "error_message": null,
  "original_request_file": "gemini_request_ServiceName_YYYYMMDD_HHMMSS_microseconds.json"
}
```

## Примечания

- Все изменения помечены комментариями `# ВРЕМЕННЫЙ ДЕБАГ`
- Код безопасен для продакшена - если дебаг-функция отсутствует, ничего не сломается
- Папка с логами создается только при первом запросе к Gemini
- Логи содержат полные тексты запросов и ответов для детального анализа
