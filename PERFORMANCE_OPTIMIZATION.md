# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Cloud Run

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ –∏ keep-alive –±–æ—Ç —Å—Ç–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ –≤ Cloud Run, —Ö–æ—Ç—è –ª–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ.

## –ü—Ä–∏—á–∏–Ω—ã –º–µ–¥–ª–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã

### 1. –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ vs –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±–ª–∞—á–Ω–∞—è –≤–µ—Ä—Å–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ `asyncio.create_task(process_update_background())` –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏, —á—Ç–æ –¥–æ–±–∞–≤–ª—è–ª–æ:
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–ª–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏
- –ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á
- –ó–∞–¥–µ—Ä–∂–∫–∏ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø—Ä—è–º—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É `await application.process_update(update)` –∫–∞–∫ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏.

### 2. Keep-alive –∑–∞–¥–∞—á–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** Keep-alive –∑–∞–¥–∞—á–∞:
- –ó–∞–ø—É—Å–∫–∞–ª–∞—Å—å –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
- –í—ã–∑—ã–≤–∞–ª–∞—Å—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º webhook –∑–∞–ø—Ä–æ—Å–µ
- –°–æ–∑–¥–∞–≤–∞–ª–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É

**–†–µ—à–µ–Ω–∏–µ:** 
- –£–º–µ–Ω—å—à–∏–ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ 5 –º–∏–Ω—É—Ç
- –£–±—Ä–∞–ª–∏ –≤—ã–∑–æ–≤—ã keep-alive –∏–∑ webhook endpoint
- –£–ø—Ä–æ—Å—Ç–∏–ª–∏ –ª–æ–≥–∏–∫—É keep-alive

### 3. –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º webhook –∑–∞–ø—Ä–æ—Å–µ:
- –ü—Ä–æ–≤–µ—Ä—è–ª—Å—è LocaleManager
- –í—ã–≤–æ–¥–∏–ª–∏—Å—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏
- –í—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±—Ä–∞–ª–∏ –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑ webhook
- –£–ø—Ä–æ—Å—Ç–∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –î–æ–±–∞–≤–∏–ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ LocaleManager

## –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è webhook endpoint
```python
# –ë–´–õ–û: –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
asyncio.create_task(process_update_background(update_data))

# –°–¢–ê–õ–û: –ü—Ä—è–º–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
await application.process_update(update)
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è keep-alive
```python
# –ë–´–õ–û: 10 –º–∏–Ω—É—Ç + –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
await asyncio.sleep(600)
await start_keep_alive_task()  # –≤ –∫–∞–∂–¥–æ–º webhook

# –°–¢–ê–õ–û: 5 –º–∏–Ω—É—Ç + —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
await asyncio.sleep(300)
# start_keep_alive_task() —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞
```

### 3. –£–ø—Ä–æ—â–µ–Ω–∏–µ webhook
```python
# –ë–´–õ–û: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
print("üì® –ü–æ–ª—É—á–µ–Ω webhook –∑–∞–ø—Ä–æ—Å")
await start_keep_alive_task()
headers = dict(request.headers)
print(f"üìä Headers: {headers}")
# ... –º–Ω–æ–≥–æ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

# –°–¢–ê–õ–û: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
update_data = await request.json()
if not update_data or not application:
    return {"ok": True}
await application.process_update(update)
```

### 4. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ LocaleManager
```python
# –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è get_cached_locale_manager()
# –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç
- –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ñ–æ–Ω–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
- –£–º–µ–Ω—å—à–µ–Ω–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ –æ—Ç keep-alive –∑–∞–¥–∞—á–∏
- –£–±—Ä–∞–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –î–æ–±–∞–≤–ª–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è LocaleManager

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
- `GET /` - –±–∞–∑–æ–≤—ã–π health check
- `GET /keepalive` - –ø—Ä–æ–≤–µ—Ä–∫–∞ keep-alive
- `GET /debug` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
1. **–ù–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** –≤ webhook endpoint
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä—è–º—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É** –≤–º–µ—Å—Ç–æ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–ö—ç—à–∏—Ä—É–π—Ç–µ —Ç—è–∂–µ–ª—ã–µ –æ–±—ä–µ–∫—Ç—ã** –∫–∞–∫ LocaleManager
4. **–ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ production
5. **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ keep-alive** - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
